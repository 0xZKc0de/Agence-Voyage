<div class="reservation-create-page">
  <div class="create-container">

    <div class="create-header">
      <h2>Finaliser votre r√©servation</h2>
      <p>Vous √™tes √† une √©tape de votre prochaine aventure</p>
    </div>

    <div class="loading-spinner" *ngIf="isLoading" style="text-align: center; padding: 20px;">
      <p>‚è≥ Chargement des circuits...</p>
    </div>

    <form [formGroup]="reservationForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading">
      <div class="content-grid">

        <div class="form-column">
          <div class="form-section">
            <h3>üìç Destination</h3>

            <div class="form-group">
              <select
                formControlName="circuitId"
                (change)="onCircuitChange($any($event.target).value)"
                class="form-select"
              >
                <option value="">S√©lectionnez un circuit</option>
                <option *ngFor="let circuit of circuits" [value]="circuit.id">
                  {{ circuit.distination || circuit.destination || circuit.nom }} ({{ circuit.prix }} DH)
                </option>
              </select>

              <div *ngIf="selectedCircuit" class="selected-info" style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 8px;">
                <strong>Description:</strong> {{ selectedCircuit.description }} <br>
                <strong>Date:</strong> {{ selectedCircuit.dateDepart | date:'dd/MM/yyyy' }}
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3>üë• Voyageurs</h3>
            <div class="form-group">
              <label>Nombre de personnes</label>
              <input
                type="number"
                formControlName="participants"
                class="form-input"
                min="1"
              />
              <small class="text-muted" *ngIf="selectedCircuit">
                Places disponibles: {{ selectedCircuit.placesRestantes || selectedCircuit.nb_places }}
              </small>
            </div>
          </div>
        </div>

        <div class="summary-column">
          <div class="summary-card">
            <h3>R√©capitulatif</h3>

            <div class="summary-row">
              <span>Prix par personne</span>
              <span>{{ (selectedCircuit?.prix) || 0 }} DH</span>
            </div>

            <div class="summary-row">
              <span>Voyageurs</span>
              <span>x {{ reservationForm.get('participants')?.value }}</span>
            </div>

            <div class="divider"></div>

            <div class="summary-row total">
              <span>Total</span>
              <span class="total-price">{{ calculateTotal() }} DH</span>
            </div>

            <button
              type="submit"
              class="btn-submit"
              [disabled]="reservationForm.invalid || isSubmitting"
            >
              <span *ngIf="!isSubmitting">Payer et R√©server</span>
              <span *ngIf="isSubmitting">Redirection...</span>
            </button>

            <button type="button" class="btn-cancel" (click)="cancel()">
              Annuler
            </button>

            <div class="secure-badge" style="margin-top: 10px; text-align: center; font-size: 0.9em; color: #666;">
              üîí Paiement s√©curis√© par PayPal
            </div>
          </div>
        </div>

      </div>
    </form>
  </div>
</div>
