<div class="reservations-page">
  <div class="reservations-header">
    <div class="header-left">
      <h2>Mes R√©servations</h2>
      <p>G√©rez vos voyages et suivez leur statut</p>
    </div>
    <div class="header-right">
      <button class="btn-new-reservation" routerLink="/client/circuits">
        + Nouvelle r√©servation
      </button>
    </div>
  </div>

  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-value">{{ totalReservations }}</div>
      <div class="stat-label">Total R√©servations</div>
    </div>
    <div class="stat-card warning">
      <div class="stat-value">{{ pendingReservations }}</div>
      <div class="stat-label">En attente</div>
    </div>
  </div>

  <div class="filters-section">
    <div class="search-box">
      <input
        type="text"
        placeholder="Rechercher par destination..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="filterReservations()"
        class="search-input"
      >
    </div>
    <div class="filter-options">
      <select [(ngModel)]="statusFilter" (ngModelChange)="filterReservations()" class="filter-select">
        <option value="">Tous les statuts</option>
        <option value="PENDING">En attente</option>
        <option value="CONFIRMED">Confirm√©e</option>
        <option value="CANCELLED">Annul√©e</option>
      </select>

      <button *ngIf="searchTerm || statusFilter" (click)="clearFilters()" class="btn-clear">
        Effacer filtres
      </button>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div> Chargement...
  </div>

  <div class="table-responsive" *ngIf="!isLoading && filteredReservations.length > 0">
    <table class="reservations-table">
      <thead>
      <tr>
        <th>N¬∞</th>
        <th>Destination</th>
        <th>Date</th>
        <th>Voyageurs</th>
        <th>Prix Total</th>
        <th>Statut</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let res of filteredReservations">
        <td>#{{ res.id }}</td>

        <td>
          <strong>{{ res.circuit?.destination || res.circuit?.distination || 'Circuit Inconnu' }}</strong>
        </td>

        <td>{{ res.date | date:'dd/MM/yyyy' }}</td>
        <td>{{ res.nbPersons }} pers.</td>

        <td class="price">{{ calculatePrice(res) }} DH</td>

        <td>
            <span class="badge" [class]="getStatusBadgeClass(res.status)">
              {{ getStatusText(res.status) }}
            </span>
        </td>

        <td class="actions">
          <button
            *ngIf="res.status !== 'CANCELLED'"
            (click)="cancelReservation(res)"
            class="btn-icon cancel"
            title="Annuler la r√©servation">
            ‚ùå Annuler
          </button>

          <button
            *ngIf="res.status === 'PENDING'"
            (click)="processPayment(res)"
            class="btn-icon pay"
            title="Payer maintenant">
            üí≥ Payer
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!isLoading && filteredReservations.length === 0" class="empty-state">
    <h3>Aucune r√©servation trouv√©e</h3>
    <p>Vous n'avez pas encore r√©serv√© de voyage ou aucun r√©sultat ne correspond √† votre recherche.</p>
  </div>
</div>
