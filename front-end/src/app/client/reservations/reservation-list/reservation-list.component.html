<div class="reservations-page">

  <div class="reservations-header">
    <div class="header-left">
      <h2>Mes RÃ©servations</h2>
      <p>Suivez l'Ã©tat de vos voyages en temps rÃ©el</p>
    </div>
    <button class="btn-new-reservation" routerLink="/client/circuits">
      <span>+</span> RÃ©server un voyage
    </button>
  </div>

  <div class="stats-overview">
    <div class="stat-item">
      <span class="stat-label">Total</span>
      <span class="stat-number">{{ totalReservations }}</span>
    </div>
    <div class="stat-item highlight">
      <span class="stat-label">En attente</span>
      <span class="stat-number">{{ pendingReservations }}</span>
    </div>
  </div>

  <div class="controls-bar">
    <div class="status-tabs">
      <button
        class="tab-btn"
        [class.active]="statusFilter === ''"
        (click)="setFilter('')">
        Tout
      </button>
      <button
        class="tab-btn"
        [class.active]="statusFilter === 'PENDING'"
        (click)="setFilter('PENDING')">
        En attente
        <span class="tab-badge" *ngIf="pendingReservations > 0">{{ pendingReservations }}</span>
      </button>
      <button
        class="tab-btn"
        [class.active]="statusFilter === 'PAID'"
        (click)="setFilter('PAID')">
        ConfirmÃ©es
      </button>
      <button
        class="tab-btn"
        [class.active]="statusFilter === 'CANCELLED'"
        (click)="setFilter('CANCELLED')">
        AnnulÃ©es
      </button>
    </div>

    <div class="search-wrapper">
      <span class="search-icon">ğŸ”</span>
      <input
        type="text"
        placeholder="Rechercher une destination..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="filterReservations()"
        class="search-input"
      >
    </div>
  </div>

  <div class="table-container">
    <table class="reservations-table">
      <thead>
      <tr>
        <th>NÂ°</th>
        <th>Destination</th>
        <th>Date</th>
        <th>Personnes</th>
        <th>Prix Total</th>
        <th>Statut</th>
        <th class="text-right">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let res of filteredReservations">
        <td class="res-id">#{{ res.id }}</td>

        <td class="res-destination">
          <div class="dest-wrapper">
            <div class="dest-icon">âœˆï¸</div>
            <span>{{ res.circuit?.destination || res.circuit?.distination || 'Circuit Inconnu' }}</span>
          </div>
        </td>

        <td class="res-date">{{ res.date | date:'dd MMM yyyy' }}</td>

        <td class="res-persons">
          <span class="person-badge">{{ res.nbPersons }}</span>
        </td>

        <td class="res-price">{{ calculatePrice(res) | number }} DH</td>

        <td>
            <span class="status-pill" [class]="getStatusBadgeClass(res.status)">
              <span class="dot"></span>
              {{ getStatusText(res.status) }}
            </span>
        </td>

        <td class="actions text-right">
          <button
            *ngIf="res.status !== 'CANCELLED'"
            (click)="cancelReservation(res)"
            class="action-btn cancel"
            title="Annuler">
            âœ•
          </button>

          <button
            *ngIf="res.status === 'PENDING'"
            (click)="processPayment(res)"
            class="action-btn pay"
            title="Payer">
            ğŸ’³
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!isLoading && filteredReservations.length === 0" class="empty-state">
    <div class="empty-icon">ğŸ“‚</div>
    <h3>Aucune rÃ©servation trouvÃ©e</h3>
    <p>Vous n'avez pas de rÃ©servations dans cette catÃ©gorie.</p>
    <button class="btn-text" (click)="clearFilters()">Voir toutes les rÃ©servations</button>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
  </div>
</div>
