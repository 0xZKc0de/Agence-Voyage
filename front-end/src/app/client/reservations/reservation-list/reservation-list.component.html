<div class="reservations-page">

  <div class="reservations-header">
    <div class="header-left">
      <h2>Mes R√©servations</h2>
      <p>Suivez l'√©tat de vos voyages en temps r√©el</p>
    </div>
    <button class="btn-new-reservation" routerLink="/client/circuits">
      <span>+</span> R√©server un voyage
    </button>
  </div>

  <div class="stats-overview">
    <div class="stat-item">
      <span class="stat-label">Total</span>
      <span class="stat-number">{{ totalReservations }}</span>
    </div>
    <div class="stat-item highlight">
      <span class="stat-label">En attente</span>
      <span class="stat-number">{{ pendingReservations }}</span>
    </div>
  </div>

  <div class="controls-bar">
    <div class="status-tabs">
      <button
        class="tab-btn"
        [class.active]="statusFilter === ''"
        (click)="setFilter('')">
        Tout
      </button>
      <button
        class="tab-btn"
        [class.active]="statusFilter === 'PENDING'"
        (click)="setFilter('PENDING')">
        En attente
        <span class="tab-badge" *ngIf="pendingReservations > 0">{{ pendingReservations }}</span>
      </button>
      <button
        class="tab-btn"
        [class.active]="statusFilter === 'PAID'"
        (click)="setFilter('PAID')">
        Confirm√©es
      </button>
      <button
        class="tab-btn"
        [class.active]="statusFilter === 'CANCELLED'"
        (click)="setFilter('CANCELLED')">
        Annul√©es
      </button>
    </div>

    <div class="search-box">
      <input
        type="text"
        placeholder="Rechercher par destination..."
        [(ngModel)]="searchTerm"
        (ngModelChange)="applyFilters()">
    </div>
  </div>

  <div *ngIf="isLoading" class="loader-container">
    <div class="spinner"></div>
  </div>

  <div class="reservations-table-container" *ngIf="!isLoading && filteredReservations.length > 0">
    <table class="res-table">
      <thead>
      <tr>
        <th>Voyage</th>
        <th>Date</th>
        <th>Voyageurs</th>
        <th>Prix Total</th>
        <th>Statut</th>
        <th class="text-right">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let res of filteredReservations">

        <td class="res-circuit">
          <div class="circuit-info">
            <span class="circuit-name">{{ res.circuit?.destination || res.circuit?.distination || 'Circuit Inconnu' }}</span>
            <span class="circuit-id">#{{ res.id }}</span>
          </div>
        </td>

        <td class="res-date">{{ res.date | date:'dd MMM yyyy' }}</td>

        <td class="res-persons">
          <span class="person-badge">{{ res.nbPersons }}</span>
        </td>

        <td class="res-price">{{ calculatePrice(res) | number }} DH</td>

        <td>
            <span class="status-pill" [class]="getStatusBadgeClass(res.status)">
              <span class="dot"></span>
              {{ getStatusText(res.status) }}
            </span>
        </td>

        <td class="actions text-right">
          <button
            *ngIf="res.status !== 'CANCELLED'"
            (click)="cancelReservation(res)"
            class="action-btn cancel"
            title="Annuler">
            ‚úï
          </button>

          <button
            *ngIf="res.status === 'PENDING'"
            (click)="processPayment(res)"
            class="action-btn pay"
            title="Payer">
            üí≥
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!isLoading && filteredReservations.length === 0" class="empty-state">
    <div class="empty-icon">üìÇ</div>
    <h3>Aucune r√©servation trouv√©e</h3>
    <p>Vous n'avez pas de r√©servations dans cette cat√©gorie.</p>
    <button class="btn-text" (click)="clearFilters()">Afficher tout</button>
  </div>

</div>
